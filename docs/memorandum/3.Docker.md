---
title: Docker
createTime: 2025/07/08 23:54:26
permalink: /memorandum/Docker/
---

## 

## 概述

&emsp;&emsp;Docker 是一个开源的应用容器引擎，基于 Go 语言并遵从 Apache2.0 协议开源。Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。

Docker 的优势：

- **轻量级高效**：比虚拟机占用更少资源，秒级启动时间
- **可移植性**：在各种云平台间迁移

## Linux 安装 Docker

官方帮助文档：https://docs.docker.com/engine/install/centos/

### 安装命令

1. 卸载之前的docker

   ```cmd
   sudo yum remove docker \
         docker-client \
         docker-client-latest \
         docker-common \
         docker-latest \
         docker-latest-logrotate \
         docker-logrotate \
         docker-engine
   ```

2. 需要的安装包

   ```yml
   yum install -y yum-utils
   ```

3. 设置镜像的仓库

   ```yml
   # 国外的，不推荐，linux命令直接报错：连接docker官网超时
   yum-config-manager \
       --add-repo \
       https://download.docker.com/linux/centos/docker-ce.repo
       
   # 国内阿里云
   yum-config-manager \
       --add-repo \
       https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
   ```

4. 更新yum软件包索引

   ```cmd
   yum makecache 
   ```

5. 安装docker相关的 docker-ce 社区版 而ee是企业版

   ```cmd
   yum install docker-ce docker-ce-cli containerd.io
   ```

6. 启动docker

   ```cmd
   service docker start
   ```

7. 查看docker状态

   ```yml
   service docker status
   ```

8. 使用docker version查看是否安装成功

   ```yml
   docker version
   ```

9. 设置docker开机自启动

   ```yml
   systemctl enable docker.service
   ```

10. 查看docker是否开机自启动成功

    ```yml
    systemctl is-enabled docker
    ```

### 配置阿里云镜像加速

```yml
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://svctvo40.mirror.aliyuncs.com"]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
```

## 核心概念

### 镜像

拉取镜像：

```shell
docker pull 镜像名:镜像版本
```

### 容器

查看运行中的容器

```shell
docker ps 参数
```

常用参数：

1. `-a, --all`: 显示所有容器，包括停止的容器。
2. `-q, --quiet`: 只显示容器 ID。
3. `-l, --latest`: 显示最近创建的一个容器，包括所有状态。

举例：

```shell
# 查看所有正在运行的容器
docker ps

# 查看所有的容器
docker ps -a
```

创建容器

```shell
docker run 参数
```

常见参数说明：

- `--name`: 给容器指定一个名称
- `-p`: 端口映射，格式为 `host_port:container_port`
- `--env` 或 `-e`: 设置环境变量。
- `-d`: 后台运行容器并返回容器 ID
- `-v`: 挂载卷，格式为 `host_dir:container_dir`。

启动、停止、重启容器语法：

```shell
docker start/stop/restart 容器名
```

- 删除容器：

```shell
# 删除单个容器
docker rm 容器名称(或容器id)

# 删除多个容器
docker rm 容器名称(或容器id) 容器名称(或容器id) 容器名称(或容器id)

# 删除所有的容器
docker rm $(docker ps -a -q)
```

### 日志

- 语法：

```shell
docker logs 参数 镜像名称
```

常见的参数：

- `--tail`: 仅显示日志的最后部分，例如 `--tail 10` 显示最后 10 行
- `-t, --timestamps`: 显示日志时间戳
- `--details`: 显示提供给日志的额外详细信息。

例子：

```shell
# 显示容器日志
docker logs my_container

# 显示最后 10 行的日志
docker logs --tail 10 my_container

# 显示带有时间戳的日志
docker logs -t my_container
```





## 常用容器

### RabbitMQ

创建文件夹

```
mkdir -p /home/docker/rabbitmq
```

拉取镜像

```
docker pull rabbitmq:management
```

运行容器

```shell
docker run -d --name rabbitmq \
-p 15672:15672 \
-p 5672:5672 \
-v /home/docker/rabbitmq:/var/lib/rabbitmq \
-e RABBITMQ_DEFAULT_USER=admin \
-e RABBITMQ_DEFAULT_PASS=admin123 \
rabbitmq:management
```
